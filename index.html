<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .calendar-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        @media (max-width: 768px) { .calendar-container { grid-template-columns: 1fr; } }
        .day-cell { min-height: 50px; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; cursor: pointer; }
        .booking-info { font-size: 10px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background-color: white; padding: 32px; border-radius: 16px; width: 90%; max-width: 480px; }
        #anonymousView table th, #anonymousView table td { text-align: center; border: 1px solid #e5e7eb; padding: 4px; font-size: 0.75rem; }
        #anonymousView table th { background-color: #f9fafb; }
        #lookupResults table th, #lookupResults table td { border: 1px solid #e2e8f0; padding: 8px; text-align: center; }
        #lookupResults table th { background-color: #f8fafc; }
    </style>
</head>
<body class="bg-gray-100 p-8 md:p-16">

    <div id="loginScreen" class="flex flex-col items-center justify-center min-h-screen">
        <div class="bg-white rounded-3xl shadow-lg p-8 w-full max-w-sm">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-6">ë¡œê·¸ì¸</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginUsername" class="block text-sm font-medium text-gray-700">ì•„ì´ë”” (ì´ë¦„)</label>
                    <input type="text" id="loginUsername" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500">
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-medium text-gray-700">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500">
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input id="rememberMe" name="remember-me" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                        <label for="rememberMe" class="ml-2 block text-sm text-gray-900">ì•„ì´ë”” ì €ì¥</label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg">ë¡œê·¸ì¸</button>
            </form>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <div class="bg-white rounded-3xl shadow-lg p-6 md:p-12 max-w-7xl mx-auto">
            <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                <div class="flex-grow">
                    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œ</h1>
                    <a href="#" id="noticeLink" class="text-sm text-blue-600 hover:underline">ì´ìš© ë° ì·¨ì†Œ ì•ˆë‚´(2025.9ì›”)</a>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="openModalBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition-transform active:scale-95">+ ì‹ ì²­</button>
                    <button id="logoutBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-full shadow-lg">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>
            <div class="mb-4 border-b border-gray-200">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="calendarTabBtn" class="px-3 py-2 font-medium text-sm rounded-md text-white bg-lime-500">ìº˜ë¦°ë”</button>
                    <button id="statusTabBtn" class="px-3 py-2 font-medium text-sm rounded-md text-gray-500 hover:text-gray-700">í˜„í™©</button>
                    <button id="lookupTabBtn" class="px-3 py-2 font-medium text-sm rounded-md text-gray-500 hover:text-gray-700 hidden">ì¡°íšŒ</button>
                    <button id="anonymousTabBtn" class="px-3 py-2 font-medium text-sm rounded-md text-gray-500 hover:text-gray-700 hidden">ë¬´ê¸°ëª…</button>
                    <button id="entertainmentTabBtn" class="px-3 py-2 font-medium text-sm rounded-md text-gray-500 hover:text-gray-700">ì ‘ëŒ€ë¹„ ì°¨ê°</button>
                </nav>
            </div>
            <div id="calendarView" class="tab-content">
                <div id="golfCourseFilterContainer" class="mb-4 p-4 bg-gray-50 rounded-lg border"></div>
                <div id="calendar" class="calendar-container"></div>
            </div>
            <div id="statusView" class="tab-content hidden">
                 <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
                    <div>
                        <div id="statusFilterContainer" class="flex flex-wrap items-center gap-x-4 gap-y-2">
                        </div>
                        <div id="adminFilterContainer" class="hidden mt-4 flex flex-col md:flex-row items-start md:items-center gap-x-4 gap-y-2 p-4 bg-gray-50 rounded-lg border">
                            </div>
                    </div>
                    <div class="flex gap-2 self-start md:self-auto">
                        <div id="adminOnlyControls" class="flex gap-2 hidden">
                            <button id="downloadExcelBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
                            <button id="uploadExcelBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full">ì—‘ì…€ ì—…ë¡œë“œ</button>
                        </div>
                        <button id="cancelSelectedBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-6 rounded-full hidden transform transition-transform active:scale-95">ì„ íƒ ì·¨ì†Œ</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow-sm">
                        <thead id="statusTableHead" class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <tr>
                                <th class="py-3 px-2 md:px-6 text-left">ì„ íƒ</th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer" data-sort="Golf Course">Golf Course <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer" data-sort="Name">Name <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer" data-sort="Date">Date <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-center cursor-pointer" data-sort="Team">Team <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer" data-sort="Time">Time <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer" data-sort="Status">Status <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer" data-sort="Comment">Comment <span class="sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody id="statusTableBody" class="text-gray-600 text-sm font-light"></tbody>
                    </table>
                </div>
            </div>
            <div id="lookupView" class="tab-content hidden">
                <div class="bg-gray-50 p-4 rounded-lg border mb-4">
                    <div class="flex flex-col md:flex-row items-center gap-4">
                         <div class="flex items-center gap-2">
                             <label for="lookupName" class="text-sm font-medium text-gray-700">ì„±ëª…</label>
                             <input type="text" id="lookupName" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                         </div>
                         <div class="flex items-center gap-2">
                            <label for="lookupDate" class="text-sm font-medium text-gray-700">ì¼ì</label>
                            <input type="date" id="lookupDate" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                         </div>
                         <button id="lookupBtn" class="w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full self-end">ì¡°íšŒ</button>
                    </div>
                </div>
                <div id="lookupResults" class="mt-6 space-y-6"></div>
            </div>
            <div id="anonymousView" class="tab-content hidden">
                <div class="flex justify-end mb-4">
                    <select id="anonymousYearSelector" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5">
                        <option value="2024">2024ë…„</option>
                        <option value="2025">2025ë…„</option>
                    </select>
                </div>
                <div id="anonymousTableContainer" class="overflow-x-auto"></div>
            </div>
            <div id="entertainmentView" class="tab-content hidden">
                <div class="mb-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <div class="flex gap-8">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">ì ‘ëŒ€ë¹„ ì°¨ê° ì´ì•¡</h3>
                                <p id="totalEntertainmentCost" class="text-3xl font-extrabold text-blue-600">â‚©0</p>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800 mb-2">ì”ì—¬ ì ‘ëŒ€ë¹„ ì°¨ê°ì•¡</h3>
                                <p id="remainingEntertainmentCost" class="text-3xl font-extrabold text-green-600">â‚©0</p>
                            </div>
                        </div>
                        <div class="flex flex-col gap-3 w-full md:w-auto">
                            <div class="flex items-center gap-2">
                                <label for="commonEntertainment" class="text-sm font-medium text-gray-700 w-24">ê³µí†µì ‘ëŒ€ë¹„</label>
                                <input type="text" id="commonEntertainment" class="block px-3 py-2 border border-gray-300 rounded-md shadow-sm w-40" placeholder="0">
                            </div>
                            <div class="flex items-center gap-2">
                                <label for="personalEntertainment" class="text-sm font-medium text-gray-700 w-24">ê°œì¸ì ‘ëŒ€ë¹„</label>
                                <input type="text" id="personalEntertainment" class="block px-3 py-2 border border-gray-300 rounded-md shadow-sm w-40" placeholder="0">
                            </div>
                            <button id="saveEntertainmentBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transform transition-transform active:scale-95">ì €ì¥</button>
                        </div>
                    </div>
                </div>
                <div id="adminEntertainmentFilter" class="mb-4 flex items-center gap-2 hidden">
                    <label for="entertainmentNameFilter" class="text-sm font-medium text-gray-700">ì´ë¦„:</label>
                    <select id="entertainmentNameFilter" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white">
                        <option value="ì „ì²´">ì „ì²´</option>
                    </select>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white rounded-lg shadow-sm">
                        <thead class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <tr>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer hover:bg-gray-300" data-sort="Golf Course">Golf Course <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer hover:bg-gray-300" data-sort="Name">Name <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer hover:bg-gray-300" data-sort="Date">Date <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-center cursor-pointer hover:bg-gray-300" data-sort="Team">Team <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer hover:bg-gray-300" data-sort="Time">Time <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-left cursor-pointer hover:bg-gray-300" data-sort="Status">Status <span class="sort-indicator"></span></th>
                                <th class="py-3 px-2 md:px-6 text-right cursor-pointer hover:bg-gray-300" data-sort="EE">ì ‘ëŒ€ë¹„ <span class="sort-indicator"></span></th>
                            </tr>
                        </thead>
                        <tbody id="entertainmentTableBody" class="text-gray-600 text-sm font-light"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="bookingModal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-gray-800">ì˜ˆì•½ ì‹ ì²­</h2>
            <form id="bookingForm" class="space-y-4">
                <input type="hidden" id="bookingId">
                <div><label for="userName" class="block text-sm font-medium text-gray-700">Name</label><input type="text" id="userName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                <div><label for="bookingDate" class="block text-sm font-medium text-gray-700">Date</label><input type="date" id="bookingDate" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                <div><label for="golfCourse" class="block text-sm font-medium text-gray-700">Golf Course</label><select id="golfCourse" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md bg-white"></select></div>
                <div><label for="numberOfTeams" class="block text-sm font-medium text-gray-700">Team</label><input type="number" id="numberOfTeams" min="1" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                <div><label for="bookingTime" class="block text-sm font-medium text-gray-700">Time</label><input type="time" id="bookingTime" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                <div><label for="bookingStatus" class="block text-sm font-medium text-gray-700">Status</label><input type="text" id="bookingStatus" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                <div><label for="notes" class="block text-sm font-medium text-gray-700">Comment</label><input type="text" id="notes" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md"></div>
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="closeModalBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full">ì·¨ì†Œ</button>
                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full transform transition-transform active:scale-95">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="noticeModal" class="modal-overlay">
        <div class="modal-content relative max-w-3xl max-h-[80vh] overflow-y-auto">
            <button id="closeNoticeBtn" class="absolute top-4 right-4 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
            <h2 class="text-2xl font-bold mb-2 text-center text-gray-800">ê³¨í”„ì˜ˆì•½ì‹œìŠ¤í…œ ì•ˆë‚´</h2>
            <p class="text-sm text-center text-gray-500 mb-6">[2025.09ì›”, ì¸ì‚¬ì´ë¬´íŒ€]</p>
            <div class="prose max-w-none text-gray-700 space-y-4">
                <div>
                    <h3 class="text-lg font-bold">ì‹ ì²­ê°€ëŠ¥ ê³¨í”„íšŒì›ê¶Œ í˜„í™©</h3>
                    <div class="pl-4 mt-2 space-y-3">
                        <div>
                            <h4 class="font-semibold">1. ë¬´ê¸°ëª…íšŒì›ê¶Œ</h4>
                            <p class="text-sm">ì´ìš©ë°©ì‹ : ê° ë²•ì¸ ë°°ì • íšŸìˆ˜ ë‚´ ë¬´ê¸°ëª… ì‚¬ìš© (1íŒ€ íšŒì›ê°€ ì ìš©)</p>
                            <ul class="list-disc list-inside text-sm space-y-1 mt-1">
                                <li><strong>ğŸ“ ë ˆì´í¬ìš°ë“œCC</strong>
                                    <ul class="list-['-_'] list-inside ml-4">
                                        <li>ì›” ì´ìš©íšŸìˆ˜ : ì£¼ì¤‘ 9íšŒ, ì£¼ë§ 6íšŒ</li>
                                        <li>ë°°ì •ëŒ€ìƒ : ì£¼ì¤‘(êµ­ë‚´ì˜ì—…íŒ€ ë“± 9ê°œíŒ€), ì£¼ë§(êµ­ë‚´ì˜ì—…ë‹´ë‹¹ì„ì› ë“± 6ëª…)</li>
                                    </ul>
                                </li>
                                <li><strong>ğŸ“ ì„¸ë¼ì§€ì˜¤CC</strong>
                                    <ul class="list-['-_'] list-inside ml-4">
                                        <li>ì›” ì´ìš©íšŸìˆ˜ : ì£¼ì¤‘ 5íšŒ, ì£¼ë§ 3íšŒ</li>
                                        <li>ëŒ€ì²´ ì´ìš© : ìŠ¤ì¹´ì´ë°¸ë¦¬ 1íšŒ ëŒ€ì²´ ì‚¬ìš© ê°€ëŠ¥</li>
                                        <li>ë°°ì •í˜„í™© : ê¸°ëª…íšŒì›ê¶Œ ë¯¸ë³´ìœ  ì •íšŒì› ë“±(ì£¼ì¤‘ 3íšŒ, ì£¼ë§ 2íšŒ)</li>
                                        <li>ì‹ ì²­ ê°€ëŠ¥ ì”ì—¬ë¶„ : ì£¼ì¤‘ 2íšŒ, ì£¼ë§ 1íšŒ</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold">2. ì„ ë¶ˆì œíšŒì›ê¶Œ</h4>
                            <ul class="list-disc list-inside text-sm space-y-1 mt-1">
                                <li><strong>ëŒ€ìƒ ê³¨í”„ì¥</strong> : ìŠ¤ì¹´ì´ë°¸ë¦¬CC, íë“œë¡œì‚¬ì´CC</li>
                                <li><strong>ë¹„ìš© êµ¬ì¡°</strong> : ì´ ë¹„ìš© 80ë§Œì›/íŒ€ (ì„ ë¶ˆê¸ˆì—ì„œ ì°¨ê°)</li>
                                <li><strong>ì§€ì› ë‚´ì—­</strong> : ì¸ì‚¬ì´ë¬´íŒ€ ì§€ì›(50ë§Œì›), ê°œì¸/ê³µí†µì ‘ëŒ€ë¹„(30ë§Œì›)</li>
                                <li><strong>ì ìš©ê°€ê²©</strong> : ì¼ë°˜ ì¸í„°ë„·íšŒì›ê°€ (íšŒì›íŠ¹ê°€ ì—†ìŒ)</li>
                                <li><strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong> : ë°˜ê¸°ë§(6ì›”/12ì›”) ì¸ì‚¬ì´ë¬´íŒ€ì—ì„œ ì ‘ëŒ€ë¹„ ì¼ê´„ ì°¨ê°. ì ‘ëŒ€ë¹„ ì‚¬ìš©ì‹œ ì°¨ê° ê¸ˆì•¡ì„ ë¯¸ë¦¬ ê³ ë ¤í•˜ì—¬ ì‚¬ìš© í•„ìš”</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold">ğŸ¯ ê³¨í”„ì¥ ì˜ˆì•½ë°©ë²•</h3>
                    <ul class="list-disc list-inside text-sm space-y-1 mt-2">
                        <li><strong>ë¬´ê¸°ëª…/ì„ ë¶ˆì œíšŒì›ê¶Œ</strong>: ê³¨í”„ ì˜ˆì•½ ì‹œìŠ¤í…œì„ í†µí•œ ì˜ˆì•½</li>
                        <li><strong>ì˜¤í”ˆ ìˆœì„œ</strong> : ì„ì› â†’ êµ­ë‚´ì˜ì—…íŒ€ 9ê°œíŒ€ â†’ êµ­ë‚´ì˜ì—… ì™¸ íŒ€ (ì˜¤í”ˆ ì£¼ê¸°: ë°˜ê¸°ì´ˆë§ˆë‹¤)</li>
                        <li><strong>ê¸°íƒ€ ì˜ˆì•½</strong> : ì›” íšŸìˆ˜ ë¯¸ë°°ì • ë˜ëŠ” ëŒ€ì¤‘ ì˜¤í”ˆ ì˜ˆì•½ì¼ ì´ìš© í¬ë§ì‹œ ë‹´ë‹¹ì(ì‹ ì„ì¤‘ ê³¼ì¥)ì—ê²Œ ì—°ë½</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold">âŒ ì˜ˆì•½ì·¨ì†Œ</h3>
                     <ul class="list-disc list-inside text-sm space-y-1 mt-2">
                        <li><strong>ì¼ë°˜ ì·¨ì†Œ</strong>: ì‹œìŠ¤í…œ ì·¨ì†ŒëŠ” í‹°ì˜¤í”„ì¼ 8ì¼ ì „ê¹Œì§€ ê°€ëŠ¥ (ê³¨í”„ì¥ë³„ ì·¨ì†Œê¸°ì¤€ ìƒì´)</li>
                        <li><strong>ìš°ì²œì·¨ì†Œ</strong>: ê³¨í”„ì¥ ê¸°ì¤€ì— ë”°ë¼ ê°€ëŠ¥, ë‹¹ì¼ ê³¨í”„ì¥ì— ì§ì ‘ ì—°ë½ í›„ ì·¨ì†Œ ì§„í–‰</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold">â° í‹°ì˜¤í”„ ë‹¹ì¼ ì•ˆë‚´</h3>
                    <ul class="list-disc list-inside text-sm space-y-1 mt-2">
                        <li><strong>ì²´í¬ì¸</strong>: í‹°ì˜¤í”„ ì‹œê°„ 30ë¶„ ì „ ì²´í¬ì¸ ì™„ë£Œ</li>
                        <li><strong>íŠ¹ì´ì‚¬í•­ í†µë³´</strong>: í‹°ì˜¤í”„ í›„ íŠ¹ì´ì‚¬í•­ ë°œìƒì‹œ ë‹¹ì¼ ë˜ëŠ” ìµì˜ì—…ì¼ì— ë‹´ë‹¹ì(ì‹ ì„ì¤‘ ê³¼ì¥)ì—ê²Œ ë©”ëª¨ ì „ë‹¬</li>
                        <li><strong>ìš°ì²œìœ¼ë¡œ ì¸í•œ ì·¨ì†Œ</strong>: í™€ì•„ì›ƒ ë“±ìœ¼ë¡œ ì¸í•œ ì°¨ê°ê¸ˆì•¡ ìƒì´ ë“±</li>
                    </ul>
                </div>
                 <div>
                    <h3 class="text-lg font-bold">ğŸ“ ë¬¸ì˜ì‚¬í•­</h3>
                     <p class="text-sm mt-2">ì‹ ì„ì¤‘ ê³¼ì¥ (ì¸ì‚¬ì´ë¬´íŒ€)</p>
                </div>
            </div>
        </div>
    </div>

    <div id="uploadModal" class="modal-overlay">
         <div class="modal-content">
            <h2 class="text-2xl font-bold mb-6">ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h2>
            <form id="uploadForm" class="space-y-4">
                <input type="file" id="excelFile" accept=".csv" required class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="closeUploadModalBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full">ì·¨ì†Œ</button>
                    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full">ì—…ë¡œë“œ</button>
                </div>
            </form>
        </div>
    </div>


    <div id="loadingOverlay" class="modal-overlay" style="display: none;">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-blue-500"></div>
    </div>

    <script>
        // ##### ì„¤ì • (Configuration) #####
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxzfPdpFnrDCm6XervyQuQm6bvShOYeM6SSJ6DcX3ijD7nWY7db1DW3FLtEOPb-IylP/exec';
        
        const CALENDAR_GOLF_COURSES = ['ë ˆì´í¬ìš°ë“œ', 'ìŠ¤ì¹´ì´ë°¸ë¦¬', 'ì„¸ë¼ì§€ì˜¤', 'íë“œë¡œì‚¬ì´'];
        const MODAL_GOLF_COURSES = ['ë ˆì´í¬ìš°ë“œ', 'ìŠ¤ì¹´ì´ë°¸ë¦¬', 'ì„¸ë¼ì§€ì˜¤', 'íë“œë¡œì‚¬ì´'];

        const GOLF_COURSE_COLORS = {
            'ë ˆì´í¬ìš°ë“œ': 'text-black',
            'ìŠ¤ì¹´ì´ë°¸ë¦¬': 'text-blue-600',
            'ì„¸ë¼ì§€ì˜¤': 'text-green-600',
            'íë“œë¡œì‚¬ì´': 'text-red-600'
        };

        const holidays = {
            '2024-01-01': 'ì‹ ì •', '2024-02-09': 'ì„¤ë‚ ', '2024-02-10': 'ì„¤ë‚ ', '2024-02-11': 'ì„¤ë‚ ', '2024-02-12': 'ì„¤ë‚  ëŒ€ì²´ê³µíœ´ì¼', '2024-03-01': 'ì‚¼ì¼ì ˆ', '2024-04-10': 'êµ­íšŒì˜ì› ì„ ê±°', '2024-05-01': 'ê·¼ë¡œìì˜ ë‚ ', '2024-05-05': 'ì–´ë¦°ì´ë‚ ', '2024-05-06': 'ì–´ë¦°ì´ë‚  ëŒ€ì²´ê³µíœ´ì¼', '2024-05-15': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ', '2024-06-06': 'í˜„ì¶©ì¼', '2024-08-15': 'ê´‘ë³µì ˆ', '2024-09-16': 'ì¶”ì„', '2024-09-17': 'ì¶”ì„', '2024-09-18': 'ì¶”ì„', '2024-10-03': 'ê°œì²œì ˆ', '2024-10-09': 'í•œê¸€ë‚ ', '2024-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤',
            '2025-01-01': 'ì‹ ì •', '2025-01-28': 'ì„¤ë‚ ', '2025-01-29': 'ì„¤ë‚ ', '2025-01-30': 'ì„¤ë‚ ', '2025-03-01': 'ì‚¼ì¼ì ˆ', '2025-05-01': 'ê·¼ë¡œìì˜ ë‚ ', '2025-05-05': 'ì–´ë¦°ì´ë‚ ', '2025-05-06': 'ë¶€ì²˜ë‹˜ ì˜¤ì‹  ë‚ ', '2025-06-06': 'í˜„ì¶©ì¼', '2025-08-15': 'ê´‘ë³µì ˆ', '2025-10-03': 'ê°œì²œì ˆ', '2025-10-06': 'ì¶”ì„', '2025-10-07': 'ì¶”ì„', '2025-10-08': 'ì¶”ì„', '2025-10-09': 'í•œê¸€ë‚ ', '2025-12-25': 'í¬ë¦¬ìŠ¤ë§ˆìŠ¤'
        };
        
        // [ìˆ˜ì •ë¨] ìœ íš¨í•œ ì˜ˆì•½ë§Œ ì¹´ìš´íŠ¸í•˜ê¸° ìœ„í•œ í•„í„° ì¡°ê±´ í•¨ìˆ˜
        // Statusê°€ 'ì˜ˆì•½ì™„ë£Œ', 'ì˜ˆì•½ì¤‘', 'ì·¨ì†Œì¤‘'ì´ê³  MPê°€ 0ì´ ì•„ë‹Œ ê±´ë§Œ ì¹´ìš´íŠ¸
        const VALID_STATUSES = ['ì˜ˆì•½ì™„ë£Œ', 'ì˜ˆì•½ì¤‘', 'ì·¨ì†Œì¤‘'];
        const IS_VALID_FOR_COUNTING = (b) => b.MP != 0 && VALID_STATUSES.includes(b.Status);

        // ì£¼ì¤‘/ì£¼ë§ íŒë‹¨ í•¨ìˆ˜ (WE ì»¬ëŸ¼ ê¸°ë°˜)
        // 'WE' ì»¬ëŸ¼ì´ "ì£¼ ë§"ì´ë©´ ì£¼ë§, ê³µë€ì´ë©´ ì£¼ì¤‘
        const isWeekendBooking = (booking) => {
            return booking['WE'] === 'ì£¼ ë§';
        };


        // ##### ì „ì—­ ìƒíƒœ ë³€ìˆ˜ (Global State) #####
        let currentUser = null;
        let bookings = [];
        let userQuotas = {};
        let users = [];
        let originalBookingForLog = null;
        let sortColumn = 'Date';
        let sortDirection = 'asc';
        let entertainmentSortColumn = 'Date';
        let entertainmentSortDirection = 'asc';
        let entertainmentSelectedName = 'ì „ì²´'; // ê´€ë¦¬ììš© ì´ë¦„ í•„í„°
        let allEntertainmentLogs = []; // â–¼â–¼â–¼ [ìˆ˜ì • 1] ì „ì—­ ë³€ìˆ˜ ì¶”ê°€ â–¼â–¼â–¼
        
        // ##### DOMContentLoaded ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ #####
        document.addEventListener('DOMContentLoaded', async () => {
            // ##### DOM ìš”ì†Œ ë³€ìˆ˜ (DOM Element Variables) #####
            const loginScreen = document.getElementById('loginScreen');
            const mainApp = document.getElementById('mainApp');
            const loginForm = document.getElementById('loginForm');
            const logoutBtn = document.getElementById('logoutBtn');
            const calendarEl = document.getElementById('calendar');
            const statusTableBody = document.getElementById('statusTableBody');
            const openModalBtn = document.getElementById('openModalBtn');
            const bookingModal = document.getElementById('bookingModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const bookingForm = document.getElementById('bookingForm');
            const calendarTabBtn = document.getElementById('calendarTabBtn');
            const statusTabBtn = document.getElementById('statusTabBtn');
            const anonymousTabBtn = document.getElementById('anonymousTabBtn');
            const lookupTabBtn = document.getElementById('lookupTabBtn');
            const calendarView = document.getElementById('calendarView');
            const statusView = document.getElementById('statusView');
            const anonymousView = document.getElementById('anonymousView');
            const lookupView = document.getElementById('lookupView');
            const adminOnlyControls = document.getElementById('adminOnlyControls');
            const cancelSelectedBtn = document.getElementById('cancelSelectedBtn');
            const downloadExcelBtn = document.getElementById('downloadExcelBtn');
            const uploadExcelBtn = document.getElementById('uploadExcelBtn');
            const uploadModal = document.getElementById('uploadModal');
            const closeUploadModalBtn = document.getElementById('closeUploadModalBtn');
            const uploadForm = document.getElementById('uploadForm');
            const golfCourseFilterContainer = document.getElementById('golfCourseFilterContainer');
            const statusFilterContainer = document.getElementById('statusFilterContainer');
            const adminFilterContainer = document.getElementById('adminFilterContainer');
            const statusTableHead = document.getElementById('statusTableHead');
            const anonymousYearSelector = document.getElementById('anonymousYearSelector');
            const lookupBtn = document.getElementById('lookupBtn');
            const noticeModal = document.getElementById('noticeModal');
            const closeNoticeBtn = document.getElementById('closeNoticeBtn');
            const noticeLink = document.getElementById('noticeLink');
            const entertainmentTabBtn = document.getElementById('entertainmentTabBtn');
            const entertainmentView = document.getElementById('entertainmentView');
            const entertainmentTableBody = document.getElementById('entertainmentTableBody');
            const totalEntertainmentCost = document.getElementById('totalEntertainmentCost');
            const remainingEntertainmentCost = document.getElementById('remainingEntertainmentCost');
            const commonEntertainment = document.getElementById('commonEntertainment');
            const personalEntertainment = document.getElementById('personalEntertainment');
            const saveEntertainmentBtn = document.getElementById('saveEntertainmentBtn');
            const adminEntertainmentFilter = document.getElementById('adminEntertainmentFilter');
            const entertainmentNameFilter = document.getElementById('entertainmentNameFilter');

            // ##### ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ #####
            showLoading(true);
            try {
                await fetchInitialData();
                initializeLoginState();
            } catch (error) {
                console.error("ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
                alert("ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
            } finally {
                showLoading(false);
            }

            // ##### ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • #####
            setupEventListeners();
        
            // ##### í•¨ìˆ˜ ì˜ì—­ (Functions) #####

            // --- ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ ê´€ë ¨ ---
            function initializeLoginState() {
                const savedUser = sessionStorage.getItem('golf_currentUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    const isValidUser = users.some(u => u.name === currentUser.name && u.phone === currentUser.phone);
                    if (isValidUser) {
                        showMainApp();
                    } else {
                        sessionStorage.removeItem('golf_currentUser');
                        showLoginScreen();
                    }
                } else {
                    showLoginScreen();
                }
            }

            function showLoginScreen() {
                const savedUsername = localStorage.getItem('golf_username');
                const savedPassword = localStorage.getItem('golf_password');
                if (savedUsername && savedPassword) {
                    document.getElementById('loginUsername').value = savedUsername;
                    document.getElementById('loginPassword').value = savedPassword;
                    document.getElementById('rememberMe').checked = true;
                }
                loginScreen.classList.remove('hidden');
                mainApp.classList.add('hidden');
            }
            
            function showMainApp() {
                loginScreen.classList.add('hidden');
                mainApp.classList.remove('hidden');
                renderApp();
            }

            // --- ì•± ë Œë”ë§ ê´€ë ¨ ---
            function renderApp() {
                const isManager = currentUser && currentUser.name === 'ì‹ ì„ì¤‘';
                anonymousTabBtn.classList.toggle('hidden', !isManager);
                lookupTabBtn.classList.toggle('hidden', !isManager);
                // ì ‘ëŒ€ë¹„ íƒ­ì€ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
                setupGolfCourseFilters();
                setupStatusFilter();
                setupAdminFilters();
                renderCalendar();
                renderStatus();
                renderEntertainmentView(); // ëª¨ë“  ì‚¬ìš©ìê°€ ìì‹ ì˜ ì ‘ëŒ€ë¹„ ë°ì´í„° í™•ì¸ ê°€ëŠ¥
                if(isManager) {
                    renderAnonymousView();
                }

                const noticeShown = localStorage.getItem('golf_notice_202509');
                if (!noticeShown) {
                    noticeModal.style.display = 'flex';
                    localStorage.setItem('golf_notice_202509', 'true');
                }
            }

            function showLoading(isLoading) {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (isLoading) {
                    document.body.style.cursor = 'wait';
                    loadingOverlay.style.display = 'flex';
                } else {
                    document.body.style.cursor = 'default';
                    loadingOverlay.style.display = 'none';
                }
            }

            async function fetchInitialData() {
                try {
                    const response = await fetch(`${SCRIPT_URL}?action=read`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    bookings = data.bookings;
                    users = data.users;
                    allEntertainmentLogs = data.entertainmentData || []; // â–¼â–¼â–¼ [ìˆ˜ì • 2] ë°ì´í„° ìˆ˜ì‹  â–¼â–¼â–¼
                    userQuotas = data.quotas.reduce((acc, q) => {
                        acc[q.Name] = q;
                        return acc;
                    }, {});
                } catch (error) {
                    console.error('Error fetching initial data:', error);
                    alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    throw error; // ì—ëŸ¬ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ ìƒìœ„ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ í•¨
                }
            }
            
            // --- UI ì»´í¬ë„ŒíŠ¸ ì„¤ì • ---
            function setupGolfCourseFilters() {
                if (golfCourseFilterContainer.childElementCount > 0) return;
                let checkboxesHtml = '<div class="flex flex-wrap items-center gap-x-4 gap-y-2">';
                CALENDAR_GOLF_COURSES.forEach(course => {
                    checkboxesHtml += `<div class="flex items-center"><input id="filter-${course}" type="checkbox" value="${course}" class="golf-course-filter h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked><label for="filter-${course}" class="ml-2 text-sm text-gray-900">${course}</label></div>`;
                });
                checkboxesHtml += `<div class="flex items-center border-l pl-4 ml-2"><input id="filter-my-bookings" type="checkbox" class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"><label for="filter-my-bookings" class="ml-2 text-sm font-semibold text-gray-900">ë‚´ ì˜ˆì•½ê±´</label></div>`;
                checkboxesHtml += '</div>';
                golfCourseFilterContainer.innerHTML = checkboxesHtml;
            }

            function setupStatusFilter() {
                if (statusFilterContainer.childElementCount > 0) return;
                const statuses = ['ì „ì²´', ...new Set(bookings.map(b => b.Status || 'ë¯¸ì •').sort())];
                let checkboxesHtml = '';
                statuses.forEach(status => {
                    const id = `status-filter-${status.replace(/\s+/g, '-')}`;
                    checkboxesHtml += `<div class="flex items-center"><input id="${id}" type="checkbox" value="${status}" class="status-filter-checkbox h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked><label for="${id}" class="ml-1 text-sm text-gray-900">${status}</label></div>`;
                });
                statusFilterContainer.innerHTML = checkboxesHtml;
            }

            function setupAdminFilters() {
                if (adminFilterContainer.childElementCount > 0) adminFilterContainer.innerHTML = '';

                const courses = ['ì „ì²´', ...[...new Set(bookings.map(b => b['Golf Course']))].sort()];
                const names = ['ì „ì²´', ...[...new Set(bookings.map(b => b.Name))].sort()];
                const dates = ['ì „ì²´', ...[...new Set(bookings.map(b => b.Date))].sort((a,b) => b.localeCompare(a))];

                let filtersHtml = `
                        <div class="flex items-center gap-2 w-full md:w-auto">
                            <label for="adminFilterCourse" class="text-sm font-medium text-gray-700">ê³¨í”„ì¥</label>
                            <select id="adminFilterCourse" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm">
                                ${courses.map(c => `<option value="${c}">${c}</option>`).join('')}
                            </select>
                        </div>
                        <div class="flex items-center gap-2 w-full md:w-auto">
                            <label for="adminFilterName" class="text-sm font-medium text-gray-700">ì´ë¦„</label>
                            <select id="adminFilterName" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm">
                                ${names.map(n => `<option value="${n}">${n}</option>`).join('')}
                            </select>
                        </div>
                        <div class="flex items-center gap-2 w-full md:w-auto">
                            <label for="adminFilterDate" class="text-sm font-medium text-gray-700">ë‚ ì§œ</label>
                            <select id="adminFilterDate" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm">
                                ${dates.map(d => `<option value="${d}">${d}</option>`).join('')}
                            </select>
                        </div>
                `;
                adminFilterContainer.innerHTML = filtersHtml;

                document.getElementById('adminFilterCourse').addEventListener('change', renderStatus);
                document.getElementById('adminFilterName').addEventListener('change', renderStatus);
                document.getElementById('adminFilterDate').addEventListener('change', renderStatus);
            }

            function setupSorting() {
                statusTableHead.addEventListener('click', (e) => {
                    const header = e.target.closest('th');
                    if (header && header.dataset.sort) {
                        const newSortColumn = header.dataset.sort;
                        if (sortColumn === newSortColumn) {
                            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                        } else {
                            sortColumn = newSortColumn;
                            sortDirection = 'asc';
                        }
                        renderStatus();
                    }
                });
            }

            // --- ë·° ë Œë”ë§ ---
            function renderCalendar() {
                calendarEl.innerHTML = '';
                // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ìº˜ë¦°ë”ì— í‘œì‹œí•  ì˜ˆì•½ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
                const calendarBookings = bookings.filter(b => CALENDAR_GOLF_COURSES.includes(b['Golf Course']) && IS_VALID_FOR_COUNTING(b));
                const selectedCourses = Array.from(document.querySelectorAll('.golf-course-filter:checked')).map(cb => cb.value);
                const showOnlyMyBookings = document.getElementById('filter-my-bookings').checked;
                let filteredBookings = calendarBookings;
                if (selectedCourses.length < CALENDAR_GOLF_COURSES.length) {
                     filteredBookings = filteredBookings.filter(b => selectedCourses.includes(b['Golf Course']));
                }
                if (showOnlyMyBookings) {
                    filteredBookings = filteredBookings.filter(b => b.Name === currentUser.name);
                }
                const bookingMap = new Map();
                filteredBookings.forEach(booking => {
                    const dateKey = booking['Date'];
                    if (!bookingMap.has(dateKey)) bookingMap.set(dateKey, new Set());
                    bookingMap.get(dateKey).add(booking['Golf Course']);
                });
                const courseAbbr = { 'ë ˆì´í¬ìš°ë“œ': 'ë ˆì´í¬', 'ìŠ¤ì¹´ì´ë°¸ë¦¬': 'ìŠ¤ì¹´ì´', 'ì„¸ë¼ì§€ì˜¤': 'ì„¸ë¼', 'íë“œë¡œì‚¬ì´': 'íë“œë¡œ' };
                const isMobile = window.innerWidth < 768;
                const today = new Date();
                const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

                // [ìˆ˜ì •ë¨] 10ì›”~12ì›” ìº˜ë¦°ë”ë§Œ í‘œì‹œ
                const currentYear = today.getFullYear();
                let currentDate = new Date(currentYear, 9, 1); // 10ì›” 1ì¼ë¶€í„° ì‹œì‘ (ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ 9=10ì›”)
                const limitDate = new Date(currentYear, 11, 31); // 12ì›” 31ì¼ê¹Œì§€

                while(currentDate <= limitDate) {
                    const year = currentDate.getFullYear(), month = currentDate.getMonth();
                    const firstDayOfMonth = new Date(year, month, 1);
                    const lastDayOfMonth = new Date(year, month + 1, 0);
                    
                    // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›”ê°„ ì‚¬ìš©ëŸ‰ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
                    const monthlyBookings = bookings.filter(b => {
                        const bookingDate = new Date(b.Date);
                        return bookingDate >= firstDayOfMonth && bookingDate <= lastDayOfMonth && IS_VALID_FOR_COUNTING(b);
                    });

                    const userMonthlyBookings = monthlyBookings.filter(b => b.Name === currentUser.name);
                    const quotaCounts = {
                        lakewood_weekday: userMonthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length,
                        lakewood_weekend: userMonthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length,
                        skyvalley: userMonthlyBookings.filter(b => b['Golf Course'] === 'ìŠ¤ì¹´ì´ë°¸ë¦¬').length,
                        hillydesicy: userMonthlyBookings.filter(b => b['Golf Course'] === 'íë“œë¡œì‚¬ì´').length,
                        seragio_weekday: userMonthlyBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && !isWeekendBooking(b)).length,
                        seragio_weekend: userMonthlyBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && isWeekendBooking(b)).length
                    };
                    const currentUserQuota = userQuotas[currentUser.name] || {};
                    const quotaHtml = `<div class="text-xs text-gray-600 grid grid-cols-3 gap-1 mb-1">
                        <span>ë ˆì´í¬(ì£¼ì¤‘): ${quotaCounts.lakewood_weekday}/${currentUserQuota.Lakewood_Weekday || 0}</span>
                        <span>ë ˆì´í¬(ì£¼ë§): ${quotaCounts.lakewood_weekend}/${currentUserQuota.Lakewood_Weekend || 0}</span>
                        <span>ìŠ¤ì¹´ì´ë°¸ë¦¬: ${quotaCounts.skyvalley}/${currentUserQuota.SkyValley || 0}</span>
                        <span>íë“œë¡œì‚¬ì´: ${quotaCounts.hillydesicy}/${currentUserQuota.HillydeSicy || 0}</span>
                        <span>ì„¸ë¼ì§€ì˜¤(ì£¼ì¤‘): ${quotaCounts.seragio_weekday}/${currentUserQuota.Seragio_Weekday || 0}</span>
                        <span>ì„¸ë¼ì§€ì˜¤(ì£¼ë§): ${quotaCounts.seragio_weekend}/${currentUserQuota.Seragio_Weekend || 0}</span>
                    </div>`;
                    let warnings = [];
                    const lakewoodWeekdayCount = monthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length;
                    const lakewoodWeekendCount = monthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length;
                    if (lakewoodWeekdayCount >= 9) warnings.push('<div class="text-red-500 font-bold text-sm">â€» ë ˆì´í¬ìš°ë“œ ì£¼ì¤‘ í•œë„ ì´ˆê³¼</div>');
                    if (lakewoodWeekendCount >= 6) warnings.push('<div class="text-red-500 font-bold text-sm">â€» ë ˆì´í¬ìš°ë“œ ì£¼ë§ í•œë„ ì´ˆê³¼</div>');
                    const seragioWeekdayCount = monthlyBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && !isWeekendBooking(b)).length;
                    const seragioWeekendCount = monthlyBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && isWeekendBooking(b)).length;
                    if (seragioWeekdayCount >= 5) warnings.push('<div class="text-red-500 font-bold text-sm">â€» ì„¸ë¼ì§€ì˜¤ ì£¼ì¤‘ í•œë„ ì´ˆê³¼</div>');
                    if (seragioWeekendCount >= 3) warnings.push('<div class="text-red-500 font-bold text-sm">â€» ì„¸ë¼ì§€ì˜¤ ì£¼ë§ í•œë„ ì´ˆê³¼</div>');
                    const monthContainer = document.createElement('div');
                    monthContainer.className = 'calendar-month bg-white p-6 rounded-lg shadow';
                    monthContainer.innerHTML = `<div class="text-left mb-2 min-h-[4.5rem]">${quotaHtml}<div>${warnings.join('')}</div></div><div class="text-xl font-bold text-center mb-4">${year}ë…„ ${month + 1}ì›”</div><div class="grid grid-cols-7 gap-1 text-center text-sm font-semibold text-gray-600 mb-2"><div class="text-red-500">ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div class="text-blue-500">í† </div></div>`;
                    const dayGrid = document.createElement('div');
                    dayGrid.className = 'grid grid-cols-7 gap-1 text-center';
                    for (let j = 0; j < new Date(year, month, 1).getDay(); j++) dayGrid.innerHTML += '<div></div>';
                    const daysInMonth = new Date(year, month + 1, 0).getDate();
                    for (let day = 1; day <= daysInMonth; day++) {
                        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        const dayOfWeek = new Date(year, month, day).getDay();
                        let dayColor = '';
                        if (dayOfWeek === 0 || holidays[dateStr]) dayColor = 'text-red-500';
                        else if (dayOfWeek === 6) dayColor = 'text-blue-500';
                        const dayCell = document.createElement('div');
                        dayCell.className = 'day-cell p-1 rounded-md';
                        if (dateStr === todayStr) dayCell.classList.add('border-2', 'border-blue-500');
                        let bookingHtml = '';
                        if (bookingMap.has(dateStr)) {
                            dayCell.classList.add('bg-gray-100');
                            const coursesOnDate = Array.from(bookingMap.get(dateStr));
                            coursesOnDate.sort((a, b) => CALENDAR_GOLF_COURSES.indexOf(a) - CALENDAR_GOLF_COURSES.indexOf(b));
                            coursesOnDate.forEach(course => { 
                                const displayName = isMobile ? (courseAbbr[course] || course) : course;
                                const textColor = GOLF_COURSE_COLORS[course] || 'text-gray-800';
                                bookingHtml += `<div class="booking-info ${textColor} font-semibold rounded px-1 truncate">${displayName}</div>`; 
                            });
                        }
                        dayCell.innerHTML = `<div class="day-number font-medium ${dayColor}">${day}</div>` + bookingHtml;
                        dayCell.addEventListener('click', () => openBookingModal(null, dateStr));
                        dayGrid.appendChild(dayCell);
                    }
                    monthContainer.appendChild(dayGrid);
                    calendarEl.appendChild(monthContainer);
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
            }
            
            function renderStatus() {
                statusTableBody.innerHTML = '';
                const isManager = currentUser && currentUser.name === 'ì‹ ì„ì¤‘';
                
                // 1. ìƒíƒœ ì²´í¬ë°•ìŠ¤ í•„í„°ë§
                const selectedStatuses = Array.from(document.querySelectorAll('.status-filter-checkbox:checked')).map(cb => cb.value);
                let filteredBookings = bookings;
                if (!selectedStatuses.includes('ì „ì²´')) {
                    filteredBookings = bookings.filter(b => selectedStatuses.includes(b.Status || 'ë¯¸ì •'));
                }

                // 2. ê´€ë¦¬ì ë“œë¡­ë‹¤ìš´ í•„í„°ë§
                adminFilterContainer.classList.toggle('hidden', !isManager);
                if (isManager) {
                    const selectedCourse = document.getElementById('adminFilterCourse').value;
                    const selectedName = document.getElementById('adminFilterName').value;
                    const selectedDate = document.getElementById('adminFilterDate').value;
                    
                    if (selectedCourse !== 'ì „ì²´') {
                        filteredBookings = filteredBookings.filter(b => b['Golf Course'] === selectedCourse);
                    }
                    if (selectedName !== 'ì „ì²´') {
                        filteredBookings = filteredBookings.filter(b => b.Name === selectedName);
                    }
                    if (selectedDate !== 'ì „ì²´') {
                        filteredBookings = filteredBookings.filter(b => b.Date === selectedDate);
                    }
                } else {
                    // ê´€ë¦¬ìê°€ ì•„ë‹ˆë©´ ë³¸ì¸ ì˜ˆì•½ë§Œ í‘œì‹œ
                    filteredBookings = filteredBookings.filter(b => b['Name'] === currentUser.name);
                }
                
                // 3. ì •ë ¬
                const sortedBookings = [...filteredBookings].sort((a, b) => {
                    const valA = a[sortColumn] || '';
                    const valB = b[sortColumn] || '';
                    let comparison = 0;
                    if (sortColumn === 'Team') {
                        comparison = parseInt(valA, 10) - parseInt(valB, 10);
                    } else {
                        comparison = String(valA).localeCompare(String(valB));
                    }
                    return sortDirection === 'asc' ? comparison : -comparison;
                });

                adminOnlyControls.classList.toggle('hidden', !isManager);
                cancelSelectedBtn.classList.toggle('hidden', !currentUser);

                if (sortedBookings.length === 0) {
                     statusTableBody.innerHTML = `<tr><td colspan="8" class="text-center py-10">í•´ë‹¹ ì¡°ê±´ì˜ ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                     return;
                }

                sortedBookings.forEach(booking => {
                    const row = document.createElement('tr');
                    let statusStyle = "border-b border-gray-200 hover:bg-gray-100";
                    if (booking['Status'] === 'ì™„ë£Œ') statusStyle = "border-b border-gray-200 bg-sky-100 text-blue-700 font-medium";
                    row.className = statusStyle;
                    
                    let displayTime = '-';
                    const timeValue = booking['Time'];
                    if (timeValue && typeof timeValue === 'string') {
                        const match = timeValue.match(/(\d{1,2}:\d{2})/);
                        displayTime = match ? match[0] : timeValue;
                    } else if (timeValue) displayTime = timeValue;
                    
                    const displayDate = booking['Date'] ? booking['Date'].substring(5) : '-';

                    row.innerHTML = `
                        <td class="py-3 px-2 md:px-6"><input type="checkbox" class="booking-checkbox" data-id="${booking.id}"></td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${booking['Golf Course']}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${booking['Name']}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${displayDate}</td>
                        <td class="py-3 px-2 md:px-6 text-center whitespace-nowrap text-xs md:text-sm">${booking['Team']}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${displayTime}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${booking['Status'] || '-'}</td>
                        <td class="py-3 px-2 md:px-6 text-xs md:text-sm">${booking['Comment'] || '-'}</td>
                    `;
                    if (isManager || booking['Name'] === currentUser.name) {
                        row.style.cursor = 'pointer';
                        row.addEventListener('click', (e) => { if (e.target.type !== 'checkbox') openBookingModal(booking); });
                    }
                    statusTableBody.appendChild(row);
                });

                document.querySelectorAll('#statusTableHead th[data-sort]').forEach(th => {
                    th.querySelector('.sort-indicator').textContent = '';
                });
                const activeHeader = document.querySelector(`#statusTableHead th[data-sort="${sortColumn}"]`);
                if (activeHeader) {
                    activeHeader.querySelector('.sort-indicator').textContent = sortDirection === 'asc' ? ' â–²' : ' â–¼';
                }
            }

            function renderAnonymousView() {
                const container = document.getElementById('anonymousTableContainer');
                const selectedYear = parseInt(anonymousYearSelector.value, 10);
                container.innerHTML = '';

                const categories = ['Lakewood_Weekday', 'Lakewood_Weekend', 'Seragio_Weekday', 'Seragio_Weekend'];
                const categoryNames = {
                    'Lakewood_Weekday': 'ë ˆì´í¬ìš°ë“œ ì£¼ì¤‘', 'Lakewood_Weekend': 'ë ˆì´í¬ìš°ë“œ ì£¼ë§',
                    'Seragio_Weekday': 'ì„¸ë¼ì§€ì˜¤ ì£¼ì¤‘', 'Seragio_Weekend': 'ì„¸ë¼ì§€ì˜¤ ì£¼ë§'
                };

                const processedData = {};
                const relevantBookings = bookings.filter(b => (b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' || b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤'));
                const userNames = [...new Set(relevantBookings.map(b => b.Name))].sort();

                userNames.forEach(name => {
                    processedData[name] = {};
                    const userBookings = relevantBookings.filter(b => b.Name === name && new Date(b.Date).getFullYear() === selectedYear);
                    userBookings.forEach(booking => {
                        const course = booking['Golf Course'];
                        const date = new Date(booking.Date);
                        const month = date.getMonth() + 1;
                        const day = date.getDate();
                        const isWeekend = isWeekendBooking(booking);
                        let category;
                        if (course === 'ë ˆì´í¬ìš°ë“œ') category = isWeekend ? 'Lakewood_Weekend' : 'Lakewood_Weekday';
                        else if (course === 'ì„¸ë¼ì§€ì˜¤') category = isWeekend ? 'Seragio_Weekend' : 'Seragio_Weekday';
                        if (!processedData[name][category]) processedData[name][category] = {};
                        if (!processedData[name][category][month]) processedData[name][category][month] = [];
                        processedData[name][category][month].push(day);
                    });
                });

                let tableHtml = `<table class="min-w-full bg-white rounded-lg shadow-sm text-sm border-collapse">`;
                tableHtml += `<thead><tr><th rowspan="2" class="p-2 border">ì˜ˆì•½ìëª…</th>`;
                categories.forEach(cat => tableHtml += `<th colspan="12" class="p-2 border">${categoryNames[cat]}</th>`);
                tableHtml += `</tr><tr>`;
                categories.forEach(() => {
                    for (let i = 1; i <= 12; i++) tableHtml += `<th class="p-2 border">${i}ì›”</th>`;
                });
                tableHtml += `</tr></thead>`;
                tableHtml += `<tbody>`;
                userNames.forEach(name => {
                    tableHtml += `<tr><td class="p-2 border font-semibold">${name}</td>`;
                    categories.forEach(cat => {
                        for (let month = 1; month <= 12; month++) {
                            const days = processedData[name]?.[cat]?.[month]?.sort((a, b) => a - b).join(', ') || '';
                            tableHtml += `<td class="p-2 border">${days}</td>`;
                        }
                    });
                    tableHtml += `</tr>`;
                });
                tableHtml += `</tbody></table>`;
                container.innerHTML = tableHtml;
            }

            // â–¼â–¼â–¼ [ìˆ˜ì • 4] ìƒˆ í•¨ìˆ˜ `loadEntertainmentInputs` ì¶”ê°€ â–¼â–¼â–¼
            /**
             * ì§€ì •ëœ ì‚¬ìš©ìì˜ ìµœê·¼ ì ‘ëŒ€ë¹„ ë‚´ì—­ì„ ì…ë ¥ì°½ì— ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
             * @param {string} targetName - ë¶ˆëŸ¬ì˜¬ ì‚¬ìš©ì ì´ë¦„ (ê´€ë¦¬ìê°€ ì„ íƒí•œ ì´ë¦„ ë˜ëŠ” í˜„ì¬ ì‚¬ìš©ì)
             */
            function loadEntertainmentInputs(targetName) {
                if (!targetName) return;

                // 1. ëŒ€ìƒ ì‚¬ìš©ìì˜ ë¡œê·¸ë§Œ í•„í„°ë§
                const userLogs = allEntertainmentLogs.filter(log => log.Name === targetName);

                if (userLogs.length === 0) {
                    // ì €ì¥ëœ ë‚´ì—­ì´ ì—†ìœ¼ë©´ ì…ë ¥ì°½ì„ ë¹„ì›ë‹ˆë‹¤.
                    commonEntertainment.value = '';
                    personalEntertainment.value = '';
                    return;
                }

                // 2. Timestampë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ê°€ì¥ ìµœê·¼ ë°ì´í„°ê°€ 0ë²ˆì§¸)
                userLogs.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));
                const latestLog = userLogs[0];

                // 3. 'ê³µí†µì ‘ëŒ€ë¹„'ì™€ 'ê°œì¸ì ‘ëŒ€ë¹„' ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
                const commonValue = latestLog['ê³µí†µì ‘ëŒ€ë¹„'] || '0';
                const personalValue = latestLog['ê°œì¸ì ‘ëŒ€ë¹„'] || '0';

                // 4. ì½¤ë§ˆë¥¼ í¬í•¨í•˜ì—¬ ì…ë ¥ì°½ì— ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤.
                commonEntertainment.value = formatNumberWithCommas(commonValue);
                personalEntertainment.value = formatNumberWithCommas(personalValue);
            }

            function renderEntertainmentView() {
                loadEntertainmentInputs(); // â–¼â–¼â–¼ [ìˆ˜ì • 5] í•¨ìˆ˜ í˜¸ì¶œ ì¶”ê°€ â–¼â–¼â–¼

                entertainmentTableBody.innerHTML = '';

                if (!currentUser) return;

                const isManager = currentUser.name === 'ì‹ ì„ì¤‘';

                // ê´€ë¦¬ì í•„í„° í‘œì‹œ/ìˆ¨ê¹€
                if (isManager) {
                    adminEntertainmentFilter.classList.remove('hidden');
                } else {
                    adminEntertainmentFilter.classList.add('hidden');
                }

                // í•„í„°: MP != 0 && (Status == 'ì˜ˆì•½ì™„ë£Œ' || Status == 'ìš°ì²œì·¨ì†Œ' || Status == 'ì˜ˆì•½ì¤‘' || Status == '')
                let entertainmentBookings = bookings.filter(b =>
                    b.MP != 0 &&
                    (b.Status === 'ì˜ˆì•½ì™„ë£Œ' || b.Status === 'ìš°ì²œì·¨ì†Œ' || b.Status === 'ì˜ˆì•½ì¤‘' || b.Status === '' || !b.Status)
                );

                // ê´€ë¦¬ì: ì´ë¦„ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸° ë° í•„í„° ì ìš©
                if (isManager) {
                    const uniqueNames = ['ì „ì²´', ...new Set(entertainmentBookings.map(b => b['Name']).filter(n => n))];
                    entertainmentNameFilter.innerHTML = uniqueNames.map(name =>
                        `<option value="${name}" ${name === entertainmentSelectedName ? 'selected' : ''}>${name}</option>`
                    ).join('');

                    // ì„ íƒëœ ì´ë¦„ìœ¼ë¡œ í•„í„°ë§
                    if (entertainmentSelectedName !== 'ì „ì²´') {
                        entertainmentBookings = entertainmentBookings.filter(b => b['Name'] === entertainmentSelectedName);
                        // ì„ íƒëœ ì‚¬ìš©ìì˜ Entertainment Log ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                        loadEntertainmentInputs(entertainmentSelectedName);
                    } else {
                        // 'ì „ì²´' ì„ íƒ ì‹œ ì…ë ¥ì°½ ë¹„ìš°ê¸°
                        commonEntertainment.value = '';
                        personalEntertainment.value = '';
                    }
                } else {
                    // ì¼ë°˜ ì‚¬ìš©ì: ë³¸ì¸ ê±´ë§Œ
                    entertainmentBookings = entertainmentBookings.filter(b => b['Name'] === currentUser.name);
                    // ë³¸ì¸ì˜ Entertainment Log ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
                    loadEntertainmentInputs(currentUser.name);
                }

                // ì ‘ëŒ€ë¹„ ì´ì•¡ ê³„ì‚°: Google Sheetì˜ 'EE' ì»¬ëŸ¼ ê°’ ì‚¬ìš©
                let totalCost = 0;
                entertainmentBookings.forEach(booking => {
                    const cost = parseInt(booking['EE']) || 0;
                    totalCost += cost;
                });

                // ì´ì•¡ í‘œì‹œ
                totalEntertainmentCost.textContent = `â‚©${totalCost.toLocaleString()}`;

                // ì”ì—¬ ì ‘ëŒ€ë¹„ ì°¨ê°ì•¡ ê³„ì‚° ë° í‘œì‹œ
                updateRemainingEntertainment(totalCost);

                // ì •ë ¬ ì ìš©
                entertainmentBookings.sort((a, b) => {
                    let aVal = a[entertainmentSortColumn];
                    let bVal = b[entertainmentSortColumn];

                    // ìˆ«ì ì»¬ëŸ¼ ì²˜ë¦¬ (Team, EE)
                    if (entertainmentSortColumn === 'Team' || entertainmentSortColumn === 'EE') {
                        aVal = parseInt(aVal) || 0;
                        bVal = parseInt(bVal) || 0;
                    } else {
                        aVal = String(aVal || '');
                        bVal = String(bVal || '');
                    }

                    if (entertainmentSortDirection === 'asc') {
                        return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                    } else {
                        return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                    }
                });

                // ì •ë ¬ í‘œì‹œ ì—…ë°ì´íŠ¸
                document.querySelectorAll('#entertainmentView th[data-sort]').forEach(th => {
                    const indicator = th.querySelector('.sort-indicator');
                    if (th.dataset.sort === entertainmentSortColumn) {
                        indicator.textContent = entertainmentSortDirection === 'asc' ? ' â–²' : ' â–¼';
                    } else {
                        indicator.textContent = '';
                    }
                });

                // í…Œì´ë¸” ë Œë”ë§
                if (entertainmentBookings.length === 0) {
                    entertainmentTableBody.innerHTML = `<tr><td colspan="7" class="text-center py-10">í•´ë‹¹ ì¡°ê±´ì˜ ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
                    return;
                }

                entertainmentBookings.forEach(booking => {
                    const row = document.createElement('tr');
                    row.className = 'border-b border-gray-200 hover:bg-gray-100';

                    let displayTime = '-';
                    const timeValue = booking['Time'];
                    if (timeValue && typeof timeValue === 'string') {
                        const match = timeValue.match(/(\d{1,2}:\d{2})/);
                        displayTime = match ? match[0] : timeValue;
                    } else if (timeValue) displayTime = timeValue;

                    const displayDate = booking['Date'] ? booking['Date'].substring(5) : '-';

                    // ì ‘ëŒ€ë¹„: Google Sheetì˜ 'EE' ì»¬ëŸ¼ ê°’ ì‚¬ìš©
                    const cost = parseInt(booking['EE']) || 0;

                    row.innerHTML = `
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${booking['Golf Course']}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${booking['Name']}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${displayDate}</td>
                        <td class="py-3 px-2 md:px-6 text-center whitespace-nowrap text-xs md:text-sm">${booking['Team']}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${displayTime}</td>
                        <td class="py-3 px-2 md:px-6 whitespace-nowrap text-xs md:text-sm">${booking['Status'] || '-'}</td>
                        <td class="py-3 px-2 md:px-6 text-right whitespace-nowrap text-xs md:text-sm font-semibold ${cost > 0 ? 'text-blue-600' : 'text-gray-400'}">â‚©${cost.toLocaleString()}</td>
                    `;
                    entertainmentTableBody.appendChild(row);
                });
            }

            // --- ë°ì´í„° ì²˜ë¦¬ ---
            async function postData(action, data) {
                showLoading(true);
                try {
                    const response = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action, ...data }) });
                    const result = await response.json();
                    if (result.status !== 'success') throw new Error(result.message);
                    alert(result.message);
                    await fetchInitialData(); // ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
                    renderApp(); // ì•±ì„ ë‹¤ì‹œ ë Œë”ë§í•©ë‹ˆë‹¤.
                } catch (error) {
                    console.error(`Error with action ${action}:`, error);
                    alert(`ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
                } finally {
                    showLoading(false);
                }
            }

            // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
            function isWeekendOrHoliday(dateStr) {
                if (holidays[dateStr]) return true;
                const date = new Date(dateStr);
                const day = date.getDay();
                return day === 0 || day === 6;
            }

            // â–¼â–¼â–¼ [ìˆ˜ì • 3] í—¬í¼ í•¨ìˆ˜ 2ê°œ, `setupEventListeners` ë°–ìœ¼ë¡œ ì´ë™ â–¼â–¼â–¼
            function formatNumberWithCommas(value) {
                // ìˆ«ìë§Œ ì¶”ì¶œ
                const number = String(value).replace(/[^0-9]/g, '');
                // ì²œì› ë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€
                return number.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            }

            function removeCommas(value) {
                return String(value).replace(/,/g, '');
            }

            // ì”ì—¬ ì ‘ëŒ€ë¹„ ì°¨ê°ì•¡ ê³„ì‚° ë° í‘œì‹œ
            function updateRemainingEntertainment(totalCost) {
                const commonValue = parseInt(removeCommas(commonEntertainment.value || '0'));
                const personalValue = parseInt(removeCommas(personalEntertainment.value || '0'));
                const remaining = totalCost - (commonValue + personalValue);

                // ì”ì—¬ì•¡ í‘œì‹œ (ìŒìˆ˜ì¼ ê²½ìš° ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œ)
                remainingEntertainmentCost.textContent = `â‚©${remaining.toLocaleString()}`;
                if (remaining < 0) {
                    remainingEntertainmentCost.className = 'text-3xl font-extrabold text-red-600';
                } else {
                    remainingEntertainmentCost.className = 'text-3xl font-extrabold text-green-600';
                }
            }
            
            function updateAvailableGolfCourses(selectedDate) {
                const golfCourseSelect = document.getElementById('golfCourse');
                golfCourseSelect.innerHTML = '';
                if (!selectedDate) return;

                const isManager = currentUser.name === 'ì‹ ì„ì¤‘';

                // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ì¼ ì´ ì˜ˆì•½ ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                const dailyCounts = bookings.filter(b => b.Date === selectedDate && IS_VALID_FOR_COUNTING(b)).reduce((acc, b) => {
                    acc[b['Golf Course']] = (acc[b['Golf Course']] || 0) + 1;
                    return acc;
                }, {});

                const isDayWeekendOrHoliday = isWeekendOrHoliday(selectedDate);

                // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›”ê°„ ì˜ˆì•½ íšŸìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
                const year = new Date(selectedDate).getFullYear();
                const month = new Date(selectedDate).getMonth();
                const firstDayOfMonth = new Date(year, month, 1);
                const lastDayOfMonth = new Date(year, month + 1, 0);

                const userMonthlyBookings = bookings.filter(b => {
                    const bookingDate = new Date(b.Date);
                    return b.Name === currentUser.name && bookingDate >= firstDayOfMonth && bookingDate <= lastDayOfMonth && IS_VALID_FOR_COUNTING(b);
                });

                const userQuotaCounts = {
                    lakewood_weekday: userMonthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length,
                    lakewood_weekend: userMonthlyBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length,
                    skyvalley: userMonthlyBookings.filter(b => b['Golf Course'] === 'ìŠ¤ì¹´ì´ë°¸ë¦¬').length,
                    hillydesicy: userMonthlyBookings.filter(b => b['Golf Course'] === 'íë“œë¡œì‚¬ì´').length,
                    seragio_weekday: userMonthlyBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && !isWeekendBooking(b)).length,
                    seragio_weekend: userMonthlyBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && isWeekendBooking(b)).length
                };
                const currentUserQuota = userQuotas[currentUser.name] || {};

                MODAL_GOLF_COURSES.forEach(course => {
                    // ì¡°ê±´ 1: ê³¨í”„ì¥ë³„ ì¼ì¼ ì´ ì˜ˆì•½ í•œë„ ì´ˆê³¼ ì—¬ë¶€ í™•ì¸
                    let isOverDailyLimit = false;
                    if (course === 'ë ˆì´í¬ìš°ë“œ') {
                        const lakewoodDailyCount = dailyCounts['ë ˆì´í¬ìš°ë“œ'] || 0;
                        if (isDayWeekendOrHoliday ? lakewoodDailyCount >= 6 : lakewoodDailyCount >= 9) {
                            isOverDailyLimit = true;
                        }
                    }
                    if (course === 'ì„¸ë¼ì§€ì˜¤') {
                        const seragioDailyCount = dailyCounts['ì„¸ë¼ì§€ì˜¤'] || 0;
                        if (isDayWeekendOrHoliday ? seragioDailyCount >= 3 : seragioDailyCount >= 5) {
                            isOverDailyLimit = true;
                        }
                    }

                    // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì´ë¯¸ ì˜ˆì•½í–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
                    const userHasBookedCourseToday = bookings.some(b => 
                        b.Name === currentUser.name &&
                        b.Date === selectedDate &&
                        b['Golf Course'] === course &&
                        IS_VALID_FOR_COUNTING(b)
                    );

                    // ì¡°ê±´ 3: ì‚¬ìš©ìì˜ ê°œì¸ë³„ ì›”ê°„ í• ë‹¹ëŸ‰(Quota) ì´ˆê³¼ ì—¬ë¶€ í™•ì¸
                    let isOverUserQuota = false;
                    if (course === 'ë ˆì´í¬ìš°ë“œ') {
                        const quota = isDayWeekendOrHoliday ? (currentUserQuota.Lakewood_Weekend || 0) : (currentUserQuota.Lakewood_Weekday || 0);
                        const count = isDayWeekendOrHoliday ? userQuotaCounts.lakewood_weekend : userQuotaCounts.lakewood_weekday;
                        if (count >= quota) isOverUserQuota = true;
                    } else if (course === 'ì„¸ë¼ì§€ì˜¤') {
                        const quota = isDayWeekendOrHoliday ? (currentUserQuota.Seragio_Weekend || 0) : (currentUserQuota.Seragio_Weekday || 0);
                        const count = isDayWeekendOrHoliday ? userQuotaCounts.seragio_weekend : userQuotaCounts.seragio_weekday;
                        if (count >= quota) isOverUserQuota = true;
                    } else if (course === 'ìŠ¤ì¹´ì´ë°¸ë¦¬' && userQuotaCounts.skyvalley >= (currentUserQuota.SkyValley || 0)) {
                        isOverUserQuota = true;
                    } else if (course === 'íë“œë¡œì‚¬ì´' && userQuotaCounts.hillydesicy >= (currentUserQuota.HillydeSicy || 0)) {
                        isOverUserQuota = true;
                    }

                    // ìµœì¢… í™•ì¸: ê´€ë¦¬ìì´ê±°ë‚˜, ëª¨ë“  ì œí•œ ì¡°ê±´ì— í•´ë‹¹í•˜ì§€ ì•Šì„ ê²½ìš°ì—ë§Œ ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€
                    if (isManager || (!isOverDailyLimit && !userHasBookedCourseToday && !isOverUserQuota)) {
                        const option = document.createElement('option');
                        option.value = course;
                        option.textContent = course;
                        golfCourseSelect.appendChild(option);
                    }
                });
            }

            function openBookingModal(booking = null, date = null) {
                bookingForm.reset();
                const isManager = currentUser.name === 'ì‹ ì„ì¤‘';
                const userNameInput = document.getElementById('userName');
                const bookingTimeInput = document.getElementById('bookingTime');
                const bookingStatusInput = document.getElementById('bookingStatus');
                [userNameInput, bookingTimeInput, bookingStatusInput].forEach(input => {
                    input.disabled = !isManager;
                    input.classList.toggle('bg-gray-200', !isManager);
                });
                
                if (booking) {
                    document.getElementById('modalTitle').textContent = 'ì˜ˆì•½ ìˆ˜ì •';
                    originalBookingForLog = { ...booking };
                    const golfCourseSelect = document.getElementById('golfCourse');
                    golfCourseSelect.innerHTML = '';
                    MODAL_GOLF_COURSES.forEach(course => {
                        const option = document.createElement('option');
                        option.value = course;
                        option.textContent = course;
                        golfCourseSelect.appendChild(option);
                    });
                    document.getElementById('bookingId').value = booking.id;
                    golfCourseSelect.value = booking['Golf Course'];
                    userNameInput.value = booking['Name'];
                    document.getElementById('bookingDate').value = booking['Date'];
                    document.getElementById('numberOfTeams').value = booking['Team'];
                    bookingTimeInput.value = booking['Time'];
                    bookingStatusInput.value = booking['Status'];
                    document.getElementById('notes').value = booking['Comment'];
                } else {
                    document.getElementById('modalTitle').textContent = 'ì˜ˆì•½ ì‹ ì²­';
                    originalBookingForLog = null;
                    userNameInput.value = currentUser.name;
                    const targetDate = date || new Date().toISOString().split('T')[0];
                    document.getElementById('bookingDate').value = targetDate;
                    document.getElementById('bookingStatus').value = 'ì˜ˆì•½ì¤‘';
                    updateAvailableGolfCourses(targetDate);
                }
                bookingModal.style.display = 'flex';
            }

            function downloadExcel() {
                if (bookings.length === 0) return alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                const headers = ["id", "Golf Course", "Name", "Date", "Team", "Time", "Status", "Comment", "MP"];
                const csv = Papa.unparse({ fields: headers, data: bookings });
                const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'golf_bookings.csv';
                link.click();
            }

            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • í•¨ìˆ˜ ---
            function setupEventListeners() {
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const username = document.getElementById('loginUsername').value;
                    const password = document.getElementById('loginPassword').value;
                    const user = users.find(u => u.name === username && String(u.phone) === password);
                    if (user) {
                        currentUser = user;
                        sessionStorage.setItem('golf_currentUser', JSON.stringify(currentUser));
                        const rememberMe = document.getElementById('rememberMe').checked;
                        if (rememberMe) {
                            localStorage.setItem('golf_username', username);
                            localStorage.setItem('golf_password', password);
                        } else {
                            localStorage.removeItem('golf_username');
                            localStorage.removeItem('golf_password');
                        }
                        showMainApp();
                    } else { alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
                });

                logoutBtn.addEventListener('click', () => {
                    currentUser = null;
                    sessionStorage.removeItem('golf_currentUser');
                    showLoginScreen();
                });
                
                [calendarTabBtn, statusTabBtn, anonymousTabBtn, lookupTabBtn, entertainmentTabBtn].forEach(tab => {
                    tab.addEventListener('click', () => {
                        calendarView.classList.add('hidden');
                        statusView.classList.add('hidden');
                        anonymousView.classList.add('hidden');
                        lookupView.classList.add('hidden');
                        entertainmentView.classList.add('hidden');
                        [calendarTabBtn, statusTabBtn, anonymousTabBtn, lookupTabBtn, entertainmentTabBtn].forEach(t => t.classList.remove('bg-lime-500', 'text-white'));

                        tab.classList.add('bg-lime-500', 'text-white');
                        if (tab.id === 'calendarTabBtn') calendarView.classList.remove('hidden');
                        else if (tab.id === 'statusTabBtn') statusView.classList.remove('hidden');
                        else if (tab.id === 'lookupTabBtn') lookupView.classList.remove('hidden');
                        else if (tab.id === 'anonymousTabBtn') anonymousView.classList.remove('hidden');
                        else if (tab.id === 'entertainmentTabBtn') entertainmentView.classList.remove('hidden');
                    });
                });
                
                openModalBtn.addEventListener('click', () => openBookingModal());
                closeModalBtn.addEventListener('click', () => bookingModal.style.display = 'none');
                
                bookingForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const bookingData = {
                        'id': document.getElementById('bookingId').value, 'Golf Course': document.getElementById('golfCourse').value,
                        'Name': document.getElementById('userName').value, 'Date': document.getElementById('bookingDate').value,
                        'Team': document.getElementById('numberOfTeams').value, 'Time': document.getElementById('bookingTime').value,
                        'Status': document.getElementById('bookingStatus').value, 'Comment': document.getElementById('notes').value
                    };
                    if (!bookingData['Golf Course']) {
                        alert('ì„ íƒí•œ ë‚ ì§œì— ì˜ˆì•½ ê°€ëŠ¥í•œ ê³¨í”„ì¥ì´ ì—†ìŠµë‹ˆë‹¤. í•œë„ê°€ ì´ˆê³¼ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                        return;
                    }
                    if (bookingData.id) {
                        let logParts = [];
                        if (bookingData.Time !== originalBookingForLog.Time) logParts.push("ì‹œê°„ë³€ê²½");
                        if (bookingData.Team != originalBookingForLog.Team) logParts.push("íŒ€ìˆ˜ë³€ê²½");
                        const logMessage = logParts.length > 0 ? logParts.join('/') : "ìˆ˜ì •";
                        await postData('update', { user: currentUser.name, booking: bookingData, logMessage: logMessage });
                    } else {
                        const isManager = currentUser.name === 'ì‹ ì„ì¤‘';
                        if (!isManager) {
                            // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ë³µ ì˜ˆì•½ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
                            const isDuplicate = bookings.some(b => 
                                b.Date === bookingData.Date && 
                                b['Golf Course'] === bookingData['Golf Course'] && 
                                b.Name === bookingData.Name &&
                                IS_VALID_FOR_COUNTING(b)
                            );
                            if (isDuplicate) {
                                alert('ì´ë¯¸ í•´ë‹¹ ë‚ ì§œì— ë™ì¼í•œ ê³¨í”„ì¥ìœ¼ë¡œ ìœ íš¨í•œ ì˜ˆì•½ ë‚´ì—­ì´ ìˆìŠµë‹ˆë‹¤.');
                                return;
                            }
                        }
                        await postData('add', { user: currentUser.name, booking: bookingData });
                    }
                    bookingModal.style.display = 'none';
                });

                cancelSelectedBtn.addEventListener('click', async () => {
                    const checkedBoxes = document.querySelectorAll('.booking-checkbox:checked');
                    if (checkedBoxes.length === 0) return alert('ì·¨ì†Œí•  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.');
                    const isManager = currentUser.name === 'ì‹ ì„ì¤‘';
                    let idsToProcess = Array.from(checkedBoxes).map(cb => cb.dataset.id).filter(id => id);
                    if (!isManager) {
                        const myBookingsIds = new Set(bookings.filter(b => b.Name === currentUser.name).map(b => b.id));
                        const originalLength = idsToProcess.length;
                        idsToProcess = idsToProcess.filter(id => myBookingsIds.has(id));
                        if (idsToProcess.length < originalLength) {
                            alert('ìì‹ ì˜ ì˜ˆì•½ë§Œ ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íƒ€ì¸ì˜ ì˜ˆì•½ì„ ì œì™¸í•˜ê³  ì§„í–‰í•©ë‹ˆë‹¤.');
                        }
                    }
                    if (idsToProcess.length === 0) {
                        alert('ì·¨ì†Œí•  ìˆ˜ ìˆëŠ” ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.');
                        return;
                    };
                    if (confirm(`ì„ íƒí•œ ${idsToProcess.length}ê°œì˜ í•­ëª©ì„ ì •ë§ ì·¨ì†Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ìƒíƒœê°€ 'ì·¨ì†Œì¤‘'ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤)`)) {
                        await postData('cancel', { user: currentUser.name, ids: idsToProcess });
                    }
                });

                golfCourseFilterContainer.addEventListener('change', renderCalendar);
                statusFilterContainer.addEventListener('change', (e) => {
                    const allCheckbox = document.getElementById('status-filter-ì „ì²´');
                    const otherCheckboxes = Array.from(document.querySelectorAll('.status-filter-checkbox:not(#status-filter-ì „ì²´)'));
                    if (e.target.id === 'status-filter-ì „ì²´') {
                        otherCheckboxes.forEach(cb => cb.checked = allCheckbox.checked);
                    } else {
                        allCheckbox.checked = otherCheckboxes.every(cb => cb.checked);
                    }
                    renderStatus();
                });
                
                document.getElementById('bookingDate').addEventListener('change', (e) => updateAvailableGolfCourses(e.target.value));

                setupSorting();
                anonymousYearSelector.addEventListener('change', renderAnonymousView);
                
                noticeLink.addEventListener('click', (e) => { e.preventDefault(); noticeModal.style.display = 'flex'; });
                closeNoticeBtn.addEventListener('click', () => { noticeModal.style.display = 'none'; });
                downloadExcelBtn.addEventListener('click', downloadExcel);
                uploadExcelBtn.addEventListener('click', () => { uploadModal.style.display = 'flex'; });
                closeUploadModalBtn.addEventListener('click', () => { uploadModal.style.display = 'none'; });
                uploadForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const file = document.getElementById('excelFile').files[0];
                    if (!file) return alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    
                    Papa.parse(file, {
                        header: true, skipEmptyLines: true,
                        complete: async (results) => {
                            await postData('addMultiple', { user: currentUser.name, bookings: results.data });
                            uploadModal.style.display = 'none';
                        },
                        error: (err) => { alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); console.error(err); }
                    });
                });

                // â–¼â–¼â–¼ [ìˆ˜ì • 3] í—¬í¼ í•¨ìˆ˜ 2ê°œê°€ ë°–ìœ¼ë¡œ ì´ë™ë˜ì–´ ì´ ë¦¬ìŠ¤ë„ˆë§Œ ë‚¨ìŠµë‹ˆë‹¤. â–¼â–¼â–¼
                commonEntertainment.addEventListener('input', (e) => {
                    e.target.value = formatNumberWithCommas(e.target.value);
                    // ì”ì—¬ ì ‘ëŒ€ë¹„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (â‚©ì™€ ì½¤ë§ˆ ëª¨ë‘ ì œê±°)
                    const totalCost = parseInt(totalEntertainmentCost.textContent.replace(/[^0-9]/g, '')) || 0;
                    updateRemainingEntertainment(totalCost);
                });

                personalEntertainment.addEventListener('input', (e) => {
                    e.target.value = formatNumberWithCommas(e.target.value);
                    // ì”ì—¬ ì ‘ëŒ€ë¹„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (â‚©ì™€ ì½¤ë§ˆ ëª¨ë‘ ì œê±°)
                    const totalCost = parseInt(totalEntertainmentCost.textContent.replace(/[^0-9]/g, '')) || 0;
                    updateRemainingEntertainment(totalCost);
                });

                // ì ‘ëŒ€ë¹„ ì €ì¥ ë²„íŠ¼
                saveEntertainmentBtn.addEventListener('click', async () => {
                    // ì½¤ë§ˆ ì œê±°í•˜ì—¬ ìˆ«ìë¡œ ë³€í™˜
                    const commonValue = removeCommas(commonEntertainment.value.trim());
                    const personalValue = removeCommas(personalEntertainment.value.trim());

                    if (!commonValue && !personalValue) {
                        alert('ê³µí†µì ‘ëŒ€ë¹„ ë˜ëŠ” ê°œì¸ì ‘ëŒ€ë¹„ ì¤‘ í•˜ë‚˜ ì´ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }

                    if (!confirm('ì ‘ëŒ€ë¹„ ì •ë³´ë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        return;
                    }

                    const entertainmentData = {
                        name: currentUser.name,
                        commonEntertainment: commonValue || '0',
                        personalEntertainment: personalValue || '0'
                    };

                    // [ì¤‘ìš”] postDataë¥¼ ì‚¬ìš©í•˜ë©´, ì„±ê³µ ì‹œ fetchInitialDataê°€ ë‹¤ì‹œ í˜¸ì¶œë˜ê³ ,
                    // renderApp() -> renderEntertainmentView() -> loadEntertainmentInputs()ê°€ ì‹¤í–‰ë˜ì–´
                    // ë°©ê¸ˆ ì €ì¥í•œ ê°’ì´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë¡œë“œë©ë‹ˆë‹¤.
                    await postData('saveEntertainment', entertainmentData);
                });

                // ì ‘ëŒ€ë¹„ ì´ë¦„ í•„í„° ë³€ê²½ (ê´€ë¦¬ììš©)
                entertainmentNameFilter.addEventListener('change', (e) => {
                    entertainmentSelectedName = e.target.value;
                    renderEntertainmentView();
                });

                // ì ‘ëŒ€ë¹„ í…Œì´ë¸” í—¤ë” ì •ë ¬
                document.querySelectorAll('#entertainmentView th[data-sort]').forEach(th => {
                    th.addEventListener('click', () => {
                        const column = th.dataset.sort;
                        if (entertainmentSortColumn === column) {
                            entertainmentSortDirection = entertainmentSortDirection === 'asc' ? 'desc' : 'asc';
                        } else {
                            entertainmentSortColumn = column;
                            entertainmentSortDirection = 'asc';
                        }
                        renderEntertainmentView();
                    });
                });
            } // setupEventListeners í•¨ìˆ˜ ë

            // ì¡°íšŒ ë¡œì§
            lookupBtn.addEventListener('click', () => {
                const lookupName = document.getElementById('lookupName').value;
                const lookupDate = document.getElementById('lookupDate').value;
                const resultsDiv = document.getElementById('lookupResults');
                resultsDiv.innerHTML = '';

                if (lookupName) {
                    const targetUserQuota = userQuotas[lookupName];
                    if (!targetUserQuota) {
                        resultsDiv.innerHTML = `<p class="text-red-500">í•´ë‹¹ ì‚¬ìš©ìì˜ í•œë„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
                        return;
                    }
                    const year = new Date().getFullYear();
                    const userBookingsForPeriod = bookings.filter(b => b.Name === lookupName && new Date(b.Date).getFullYear() === year && new Date(b.Date).getMonth() >= 8);
                    
                    // [ìˆ˜ì •ë¨] IS_VALID_FOR_COUNTING í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ì‚¬ìš© ê±´ìˆ˜ë§Œ ê³„ì‚°í•©ë‹ˆë‹¤.
                    const userUsedBookings = userBookingsForPeriod.filter(b => IS_VALID_FOR_COUNTING(b));

                    const usedCounts = {
                        Lakewood_Weekday: userUsedBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && !isWeekendBooking(b)).length,
                        Lakewood_Weekend: userUsedBookings.filter(b => b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ' && isWeekendBooking(b)).length,
                        SkyValley: userUsedBookings.filter(b => b['Golf Course'] === 'ìŠ¤ì¹´ì´ë°¸ë¦¬').length,
                        HillydeSicy: userUsedBookings.filter(b => b['Golf Course'] === 'íë“œë¡œì‚¬ì´').length,
                        Seragio_Weekday: userUsedBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && !isWeekendBooking(b)).length,
                        Seragio_Weekend: userUsedBookings.filter(b => b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤' && isWeekendBooking(b)).length
                    };
                    const monthlyUsage = {};
                    for (let i = 9; i <= 12; i++) monthlyUsage[i] = { Lakewood_Weekday: 0, Lakewood_Weekend: 0, SkyValley: 0, HillydeSicy: 0, Seragio_Weekday: 0, Seragio_Weekend: 0 };
                    userUsedBookings.forEach(b => {
                        const month = new Date(b.Date).getMonth() + 1;
                        if (month >= 9) {
                            const isWeekend = isWeekendBooking(b);
                            if (b['Golf Course'] === 'ë ˆì´í¬ìš°ë“œ') monthlyUsage[month][isWeekend ? 'Lakewood_Weekend' : 'Lakewood_Weekday']++;
                            else if (b['Golf Course'] === 'ìŠ¤ì¹´ì´ë°¸ë¦¬') monthlyUsage[month].SkyValley++;
                            else if (b['Golf Course'] === 'íë“œë¡œì‚¬ì´') monthlyUsage[month].HillydeSicy++;
                            else if (b['Golf Course'] === 'ì„¸ë¼ì§€ì˜¤') monthlyUsage[month][isWeekend ? 'Seragio_Weekend' : 'Seragio_Weekday']++;
                        }
                    });
                    let resultHtml = `<h3 class="text-lg font-bold mb-2">${lookupName}ë‹˜ ì¡°íšŒ ê²°ê³¼ (9ì›”-12ì›”)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold mb-2">ì—°ê°„ í•œë„ ë° ì‚¬ìš© í˜„í™© (9ì›”-12ì›”)</h4>
                            <table class="w-full text-sm">
                                <thead><tr><th>í•­ëª©</th><th>ë°°ì •(4ê°œì›”)</th><th>ì‚¬ìš©</th><th>ì”ì—¬</th></tr></thead>
                                <tbody>
                                    <tr><td>ë ˆì´í¬ìš°ë“œ(ì£¼ì¤‘)</td><td>${(targetUserQuota.Lakewood_Weekday || 0) * 4}</td><td>${usedCounts.Lakewood_Weekday}</td><td>${(targetUserQuota.Lakewood_Weekday || 0) * 4 - usedCounts.Lakewood_Weekday}</td></tr>
                                    <tr><td>ë ˆì´í¬ìš°ë“œ(ì£¼ë§)</td><td>${(targetUserQuota.Lakewood_Weekend || 0) * 4}</td><td>${usedCounts.Lakewood_Weekend}</td><td>${(targetUserQuota.Lakewood_Weekend || 0) * 4 - usedCounts.Lakewood_Weekend}</td></tr>
                                    <tr><td>ìŠ¤ì¹´ì´ë°¸ë¦¬</td><td>${(targetUserQuota.SkyValley || 0) * 4}</td><td>${usedCounts.SkyValley}</td><td>${(targetUserQuota.SkyValley || 0) * 4 - usedCounts.SkyValley}</td></tr>
                                    <tr><td>íë“œë¡œì‚¬ì´</td><td>${(targetUserQuota.HillydeSicy || 0) * 4}</td><td>${usedCounts.HillydeSicy}</td><td>${(targetUserQuota.HillydeSicy || 0) * 4 - usedCounts.HillydeSicy}</td></tr>
                                    <tr><td>ì„¸ë¼ì§€ì˜¤(ì£¼ì¤‘)</td><td>${(targetUserQuota.Seragio_Weekday || 0) * 4}</td><td>${usedCounts.Seragio_Weekday}</td><td>${(targetUserQuota.Seragio_Weekday || 0) * 4 - usedCounts.Seragio_Weekday}</td></tr>
                                    <tr><td>ì„¸ë¼ì§€ì˜¤(ì£¼ë§)</td><td>${(targetUserQuota.Seragio_Weekend || 0) * 4}</td><td>${usedCounts.Seragio_Weekend}</td><td>${(targetUserQuota.Seragio_Weekend || 0) * 4 - usedCounts.Seragio_Weekend}</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                             <h4 class="font-semibold mb-2">ì›”ë³„ ì‚¬ìš© í˜„í™©</h4>
                             <table class="w-full text-sm">
                                 <thead><tr><th>ì›”</th><th>ë ˆì´í¬(ì£¼ì¤‘)</th><th>ë ˆì´í¬(ì£¼ë§)</th><th>ìŠ¤ì¹´ì´ë°¸ë¦¬</th><th>íë“œë¡œì‚¬ì´</th><th>ì„¸ë¼ì§€ì˜¤(ì£¼ì¤‘)</th><th>ì„¸ë¼ì§€ì˜¤(ì£¼ë§)</th></tr></thead>
                                 <tbody>`;
                    for(let i = 9; i <= 12; i++) resultHtml += `<tr><td>${i}ì›”</td><td>${monthlyUsage[i].Lakewood_Weekday}</td><td>${monthlyUsage[i].Lakewood_Weekend}</td><td>${monthlyUsage[i].SkyValley}</td><td>${monthlyUsage[i].HillydeSicy}</td><td>${monthlyUsage[i].Seragio_Weekday}</td><td>${monthlyUsage[i].Seragio_Weekend}</td></tr>`;
                    resultHtml += `</tbody></table></div></div>`;
                    resultsDiv.innerHTML = resultHtml;

                } else if (lookupDate) {
                    const availableCourses = getAvailableCoursesForDate(lookupDate);
                       let resultHtml = `<h3 class="text-lg font-bold mb-2">${lookupDate} ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ (í˜„ì¬ ì‚¬ìš©ì ê¸°ì¤€)</h3>
                                     <ul class="list-disc list-inside">`;
                    MODAL_GOLF_COURSES.forEach(course => {
                        const isAvailable = availableCourses.includes(course);
                        resultHtml += `<li>${course}: <span class="font-bold ${isAvailable ? 'text-green-600' : 'text-red-600'}">${isAvailable ? 'ê°€ëŠ¥' : 'ë¶ˆê°€ëŠ¥'}</span></li>`;
                    });
                    resultHtml += `</ul>`;
                    resultsDiv.innerHTML = resultHtml;
                } else {
                    resultsDiv.innerHTML = '<p>ì¡°íšŒí•  ì´ë¦„ ë˜ëŠ” ë‚ ì§œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>';
                }
            });
        });

    </script>
</body>
</html>